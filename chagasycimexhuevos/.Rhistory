a <- available.packages()
head(rownames(a), 3)
install.packages("slidify")
install.packages(c("ggplot2", "devtools"))
install.packages("slidify")
source("http://bioconductor.org/bioLite.R")
biocLite()
library(ggplot2)
search()
"2015-03-23"+30
a<-as.Date("2015-03-23")
a+40
+90
a+90
a+100
-7
a+93
x<-c(0,1,2,NA, FALSE)
x
is.na(x[3])
requiredPackages <- c("XML"
,"doParallel", "lubridate","PBSmapping","plyr","inline","Rcpp"
)
packages <- requiredPackages[!(requiredPackages %in% rownames(installed.packages()))]
if(length(packages) > 0) {
install.packages(packages)
}
fa<-1100+200+26150+2000+2865
fa
2*32315
fees<-((1958+370+168+250)*2)+150
fees
fees+health+rent
fees<-((1958+370+168+250)*2)+150
health<-1570*2
rent<-4326*2
fees+health+rent
tuition(21088*2)
fa<-(1100+200+26150+2000+2865)*2
fa
*
tuition<-(21088*2)
fees<-((1958+370+168+250)*2)+150
health<-1570*2
rent<-4326*2
expense<-fees+health+rent
expenses
expense
expense+tuition
y<-expense+tuition
fa-y
tuition
health+fees
fees
?binom.test
bisampsize<-function(m){
((1.96/m)^2)*0.25
}
bisampsize(0.5)
bisampsize<-function(m){
((1.96/m)^2)*0.25
}
bisampsize(0.25)
bisampsize<-function(m){
((1.96/m)^2)*0.25
}
bisampsize(0.20)
1/12
3/12
binom.power
library(binom)
install.packages(binom)
install.packages("binom")
version
x4 <- sample(1:10, 5, replace=T)
x4
tray1<-sample(1:4, 4)
tray1`
r
)
q
;
''
'
""
)
asdf
104r
+
)
""
'
''
''
sample(1:4, 4)
sample(1:4, 4)
tray1<-
sample(1:4,4)
tray2<-sample(1:4,4)
tray3<-sample(1:4,4)
tray4<-sample(1:4,4)
tray1
tray2
tray3
tray4
quiz<-81.5*15
mid<-84*30
quiz+mid
quiz<-81.5*.15
mid<-84*.30
quiz+mid
100-37.4
quiz<-81.5*.15
mid<-84*.25
hw1<-6*.1
quiz+mid+hw1
.8*50
rnorm(4,4)
sample(1:4,4)
sample(1:4,4)
sample(1:4,4)
sample(1:4,4)
library(lubridate) #para extracting dates
library(reshape2) #para make the wide data into long data
library(matrixStats)
library(ggplot2)
library(plyr)  #para rbind.fill function
library(geeM)
library(MASS)
library(lmtest)
library(pscl)
library(survival)
library(doBy)
library(missMDA)
library(Rmisc) #summarySE command
library(lme4)#linear mixed effects
library(nlme)
setwd("c:\\Users\\tradylan\\Documents\\Laboratory\\chagasycimexhuevos")
FFdataPC <- read.csv("FertilityFecundityDataPC.csv")
#to determine the number of principle components that could be used from PCA
#conduct Leave One Out Cross validation.
#estimPCA<-estim_ncpPCA(pcad, ncp.min=0, ncp.max=4, method.cv="loo", method="EM")
#estim_ncpPCA(pcad, ncp.min=0, ncp.max=4, method.cv="loo")
#estim_ncpPCA(Hpcad, ncp.min=0, ncp.max=4, method.cv="loo")
#determines that the first 3 components could be used for each.
# ###############################################################################
# #==============================================================================
# #ahora tenomos muchas graficas, podemos empezar haciendo el modelo
# #########################################################
# #getting model data
# #[1]coefficient
# #[2]residuals
# #[3]fitted values
# #[4]effects?
# #[5]R
# #[8]Link Function and NB value
# #[10] deviance
# #[11]AIC
# #[14]Weights
# #Model with infection and lifespan as covariates.
lifespanmod<-glm.nb(egg_total~infected+lifespan, data=FFdataPC )
summary(lifespanmod )
#AIC==1636.7 P(infected)==0.107
#Null Model without any temperature or humidity variables.
nullmodel<- glm.nb(egg_total~infected, data=FFdataPC, offset(log(lifespan)))
summary(nullmodel)  #AIC==26710   P=<2e-16 *** Theta is 1.13
#Check if poisson would be better
poissonmod<-glm(egg_total~infected, offset(log(lifespan)), data=FFdataPC, family="poisson")
#test from http://www.ats.ucla.edu/stat/r/dae/nbreg.htm
X2 <- 2*(logLik(nullmodel)-logLik(poissonmod))
pchisq(X2, df=1, lower.tail=FALSE)  #is the df=1 because they are the same, except for theta?
lrtest(poissonmod, nullmodel) #this does the same thing, again shows that nb is better
#This rules out poisson
#check for 0 inflation
nullzmod<- zeroinfl(egg_total~infected+offset(log(lifespan)), data=FFdataPC)
vuong(nullmodel, nullzmod) #null model is better, so no zero inflation
#skip to to line 587 to show colinearity.
# ###Now just do a univariate analysis
# maxtempmodel<- glm.nb(egg_total~avmaxtemp, data=FFdata, offset(log(lifespan)))
# mintempmodel<- glm.nb(egg_total~avmintemp, data=FFdata, offset(log(lifespan)))
# maxhummodel<- glm.nb(egg_total~avmaxhum, data=FFdata, offset(log(lifespan)))
# minhummodel<- glm.nb(egg_total~avminhum, data=FFdata, (log(lifespan)))
#
# #look at summary to check AIC and P value
# summary(maxtempmodel)  #AIC==
# summary(mintempmodel) #AIC==
# summary(maxhummodel) #AIC==
# summary(minhummodel) #AIC==
#Model with Average Minimum Temperature and max humidity model
selectedmodel<-glm.nb(egg_total~infected+avmaxtemp+avminhum, data=FFdataPC, offset(log(lifespan)))
summary(selectedmodel)
#full models
fullmodel<-glm.nb(egg_total~infected+avmaxtemp+avminhum+avmaxhum+avmintemp, data=FFdataPC, offset(lifespan))
summary(fullmodel) #AIC==
plot(FFdataPC$avmaxhum, FFdataPC$avminhum)
#Alternative models (2 variables)  #all of which the full model has a better AIC
AltModelA<-glm.nb(egg_total~infected+avmintemp+avminhum, data=FFdataPC, offset(log(lifespan)))
summary(AltModelA) #AIC==
AltModelB<-glm.nb(egg_total~infected+avmaxtemp+avmaxhum, data=FFdataPC, offset(log(lifespan)))
summary(AltModelB) #AIC==
AltModelC<-glm.nb(egg_total~infected+avmintemp+avmaxhum, data=FFdataPC, offset(log(lifespan)))
summary(AltModelC) #AIC==
AltModelD<-glm.nb(egg_total~infected+avminhum+avmaxhum, data=FFdataPC, offset(log(lifespan)))
summary(AltModelD) #AIC==
AltModelE<-glm.nb(egg_total~infected+avmintemp+avmaxtemp, data=FFdataPC, offset(log(lifespan)))
summary(AltModelE) #AIC==
#Alternative Models with 3 Variables
AltModelF<-glm.nb(egg_total~infected+avmintemp+avmaxtemp+avminhum, data=FFdataPC, offset(log(lifespan)))
summary(AltModelF) #AIC==
AltModelG<-glm.nb(egg_total~infected+avmintemp+avmaxtemp+avmaxhum, data=FFdataPC, offset(log(lifespan)))
summary(AltModelG) #AIC==
AltModelH<-glm.nb(egg_total~infected+avmintemp+avmaxhum+avminhum, data=FFdataPC, offset(log(lifespan)))
summary(AltModelH) #AIC==
AltModelI<-glm.nb(egg_total~infected+avmaxhum+avmaxtemp+avminhum, data=FFdataPC, offset(log(lifespan)))
summary(AltModelI) #AIC==
#it is likely that colinearity is inflating the significance of eachy variable.
#thus try principle components and not each varriable by itself
plot(FFdataPC$avmaxtemp, FFdataPC$avmintemp)
plot(FFdataPC$avmaxtemp, FFdataPC$avmaxhum)
plot(FFdataPC$avmaxtemp, FFdataPC$avminhum)
plot(FFdataPC$avmintemp, FFdataPC$avmaxhum)
plot(FFdataPC$avmintemp, FFdataPC$avminhum)
plot(FFdataPC$avmaxhum, FFdataPC$avminhum)
#
#
# ###############################################################################
#   #Repeat for hatching models/ SKIP TO LINE 735 : COLINEARITY
# #==============================================================================
#First Create data set without 0 values(can't divide by 0)
hasno<-which(FFdataPC$egg_total=="0")
FFnonaPC<-FFdataPC[-hasno,]
#Null Model without any temperature or humidity variables.
pnullhmodel<- glm(hatch_total~infected, data=FFnonaPC, offset(log(egg_total)),family="poisson")
nbnullhmodel<-glm.nb(hatch_total~infected, data=FFnonaPC, offset(log(egg_total)))
lrtest(pnullhmodel, nbnullhmodel)
#    #This rules out poisson
# #now look at zero inflation
playzero <- zeroinfl(hatch_total~infected +offset(log(egg_total)), data=FFnonaPC, dist="negbin" )
vuong(playzero, nbnullhmodel)  #significantly positive, implies zero inflation is better
#add lifespan to model to see if it is helpful
nullhmodelB<- glm(hatch_total~infected+lifespan, data=FFnonaPC, offset(egg_total),family="poisson")
summary(nullhmodelB) #AIC==179486,and thus significantly beneficial
#
# #   ###Now just do a univariate analysis
# #   hmaxtempmodel<- glm(hatch_total~havmaxtemp, data=FFnonaPC, offset(egg_total),family="poisson")
# #   hmintempmodel<- glm(hatch_total~havmintemp, data=FFnonaPC, offset(egg_total),family="poisson")
# #   hmaxhummodel<- glm(hatch_total~havmaxhum, data=FFnonaPC, offset(egg_total),family="poisson")
# #   hminhummodel<- glm(hatch_total~havminhum, data=FFnonaPC, offset(egg_total),family="poisson")
# #
#McFadden's pseudo R-squared
pRsq<-function(nulldev, residdev) {
pseudoRsq<-1-(residdev/nulldev)
pseudoRsq
}
# #
# #   #look at summary to check AIC and P value
# #   summary(hmaxtempmodel)  #AIC==336158
# #     pRsq(hmaxtempmodel$null.deviance, hmaxtempmodel$deviance)#0.194
# #     plot(hmaxtempmodel)
# #   summary(hmintempmodel) #AIC==373140
# #     pRsq(hmintempmodel$null.deviance, hmintempmodel$deviance)#0.087
# #   summary(hmaxhummodel) #AIC==307829
# #     pRsq(hmaxhummodel$null.deviance, hmaxhummodel$deviance)#0.275
# #   summary(hminhummodel) #AIC==  304791
# #     pRsq(hminhummodel$null.deviance, hminhummodel$deviance)#0.284
#Complete Model (all variants)
hfullmodel<- glm(hatch_total~infected+havminhum+havmaxhum+havmintemp+havmaxtemp,offset(egg_total),data=FFdataPC, offset(egg_total),family="poisson")
summary(hfullmodel) #AIC==175426
# #Need to recalculate with poisson
# #Model with Average Minimum Temperature and max humidity model (from univariate)
hselectedmodel<-glm(hatch_total~infected+lifespan+havmaxtemp+havminhum, data=FFdataPC, offset(egg_total),family="poisson")
summary(hselectedmodel)  #AIC==173490   P(infection)==< 2e-16 ***
#Alternative models 2 Variables
hAltModelA<-glm(hatch_total~infected+lifespan+havmintemp+havminhum, data=FFdataPC, offset(egg_total),family="poisson")
summary(hAltModelA) #AIC==172242
hAltModelB<-glm(hatch_total~infected+lifespan+havmaxtemp+havmaxhum, data=FFdataPC, offset(egg_total),family="poisson")
summary(hAltModelB) #AIC==175427 (worse than full model)
hAltModelC<-glm(hatch_total~infected+lifespan+havmintemp+havmaxhum, data=FFdataPC, offset(egg_total),family="poisson")
summary(hAltModelC) #AIC== 173933
hAltModelH<-glm(hatch_total~infected+lifespan+havminhum+havmaxhum, data=FFdataPC, offset(egg_total),family="poisson")
summary(hAltModelH) #AIC== 167718
hAltModelI<-glm(hatch_total~infected+lifespan+havmintemp+havmaxtemp, data=FFdataPC, offset(egg_total),family="poisson")
summary(hAltModelI) #AIC==172095
#Alternative models 3 variables
hAltModelD<-glm(hatch_total~infected+lifespan+havmaxtemp+havmintemp+havminhum, data=FFdataPC, offset(egg_total),family="poisson")
hAltModelE<-glm(hatch_total~infected+lifespan+havmaxtemp+havmintemp+havmaxhum, data=FFdataPC, offset(egg_total),family="poisson")
hAltModelF<-glm(hatch_total~infected+lifespan+havmaxtemp+havmaxhum+havminhum, data=FFdataPC, offset(egg_total),family="poisson")
hAltModelG<-glm(hatch_total~infected+lifespan+havmaxhum+havmintemp+havminhum, data=FFdataPC, offset(egg_total),family="poisson")
summary(hAltModelD) #AIC==170664
summary(hAltModelE)#AIC==171335
summary(hAltModelF)#AIC==167568***
pRsq(hAltModelF$null.deviance, hAltModelF$deviance) #0.6815045
summary(hAltModelG)#AIC==167409***
pRsq(hAltModelG$null.deviance, hAltModelG$deviance) #0.6819634
#Alternative Models 1 variable. hc<- hatch complete  (2 variable models are better)
hcmaxtempmodel<- glm(hatch_total~infected+lifespan+havmaxtemp, data=FFdataPC, offset(egg_total),family="poisson")
hcmintempmodel<- glm(hatch_total~infected+lifespan+havmintemp, data=FFdataPC, offset(egg_total),family="poisson")
hcmaxhummodel<- glm(hatch_total~infected+lifespan+havmaxhum, data=FFdataPC, offset(egg_total),family="poisson")
hcminhummodel<- glm(hatch_total~infected+lifespan+havminhum, data=FFdataPC, offset(egg_total),family="poisson")
summary(hcmaxtempmodel)  #AIC==179349
summary(hcmintempmodel) #AIC==179063
summary(hcmaxhummodel) #AIC==175945
summary(hcminhummodel) #AIC==174323
FFdataPC$trial<-as.factor(FFdataPC$trial)
FFdataPC$mouseidnum<-as.factor(FFdataPC$trial)#163793  <-so we shoudl include trial
trialmod<- glm(hatch_total~infected+lifespan+havmaxhum+havmintemp+havminhum+trial, data=FFdataPC, offset(egg_total),family="poisson")
summary(trialmod) #AIC==145802
pRsq(trialmod$null.deviance, trialmod$deviance) #0.744
trialintmod<-glm(hatch_total~infected+lifespan+havmaxhum+havmintemp+havminhum+trial+infected*trial, data=FFdataPC, offset(egg_total),family="poisson")
summary(trialintmod) #144487  <- even better than just trial
pRsq(trialintmod$null.deviance, trialintmod$deviance) #0.7482648
trialintmodmxt<-glm(hatch_total~infected+lifespan+havmaxhum+havmintemp+havminhum+havmaxtemp+trial+infected*trial, data=FFdataPC, offset(egg_total),family="poisson")
summary(trialintmodmxt) #143768  <-best model thus far, having all variables
pRsq(trialintmodmxt$null.deviance, trialintmodmxt$deviance) #0.7503481
##################do the same but for egg laid model
completemodel<-glm.nb(hatch_total~infected+lifespan+avmaxhum+avmintemp+avminhum+avmaxtemp+trial+infected*trial, data=FFdataPC, offset(egg_total))
summary(completemodel) #91904  <-best model thus far
pRsq(completemodel$null.deviance, completemodel$deviance) #0.648106
completemodelni<-glm.nb(hatch_total~infected+lifespan+avmaxhum+avmintemp+avminhum+avmaxtemp+trial, data=FFdataPC, offset(egg_total))
summary(completemodelni) #91904  <-best model thus far
glm.nb(egg_total~infected+lifespan+avmaxhum+avmintemp+avminhum+avmaxtemp, data=FFdataPC, offset(lifespan))
#AIC==25058
glm.nb(egg_total~infected+lifespan+avmintemp+avminhum+avmaxtemp+trial, data=FFdataPC, offset(lifespan))
#AIC==25018
glm.nb(egg_total~infected+lifespan+avmintemp+avminhum+avmaxtemp+trial, data=FFdataPC, offset(lifespan))
#AIC==25017
glm.nb(egg_total~infected+lifespan+avmintemp+avminhum+avmaxtemp+trial*infected, data=FFdata, offset(lifespan))
#AIC==24960
glm.nb(egg_total~infected+lifespan+avmintemp+avminhum+trial*infected, data=FFdataPC, offset(lifespan))
#AIC==24960
#same, but all variables are signifcant
########################################################################
pceggmod0 <- glm.nb(egg_total~infected, data=FFdataPC, offset(log(lifespan)))
#Model with 1 PC
pceggmod1 <- glm.nb(egg_total~infected+PC1, data=FFdataPC,
offset(log(lifespan)))
#Model with 2 PC
pceggmod2 <- glm.nb(egg_total~infected+PC1+PC2, data=FFdataPC,
offset(log(lifespan)))
#Model with 2PC and trial
pceggmod2b <- glm.nb(egg_total~infected+PC1+PC2+factor(trial), data=FFdataPC,
offset(log(lifespan)))
#Model with trial and PC2 interaction
pceggmod2c <- glm.nb(egg_total~infected+PC1+PC2*factor(trial), data=FFdataPC,
offset(log(lifespan)))
#Model with trial and PC1 Interaction
pceggmod2d <- glm.nb(egg_total~infected+PC2+PC1*factor(trial), data=FFdataPC,
offset(log(lifespan)))
#Model with trial interacting with both PC2 and PC1
pceggmod2e <- glm.nb(egg_total~infected+PC1*factor(trial)+PC2*factor(trial),
data=FFdataPC, offset(log(lifespan)))
#Model with 3 PC
pceggmod3 <- glm.nb(egg_total~infected+PC1+PC2+PC3, data=FFdataPC,
offset(log(lifespan)))
#Model without PC2 (more significant that 1,2, and 3 if no trial interactions)
pceggmod3b <- glm.nb(egg_total~infected+PC1+PC3, data=FFdataPC,
offset(log(lifespan)))
pceggmod3c <- glm.nb(egg_total~infected+PC1+PC2+PC3+factor(trial),
data=FFdataPC, offset(log(lifespan)))
pceggmod3d <- glm.nb(egg_total~infected+PC1+PC3+factor(trial), data=FFdataPC,
offset(log(lifespan)))
#Full Model with all Principle Components #do not use, may overfit
pceggmod4 <- glm.nb(egg_total~infected+PC1+PC2+PC3+PC4, data=FFdataPC,
offset(log(lifespan)))
#look at AIC's
pceggmod0#4327
pceggmod1#4263
pceggmod2#4264
pceggmod2b#4199
pceggmod2c#4132
pceggmod2d#4129
pceggmod2e#4127***We will use this model
pceggmod3#4250
pceggmod3b#4248
pceggmod3c#4197.7
pceggmod3d#4239
pceggmod4#4215
#perform likelihood ratio test
lrtest(pceggmod4,pceggmod2)
#both test show pceggmod4 are significantly better than any other
lrtest(pceggmod4,pceggmod1)
lrtest(pceggmod3,pceggmod0)
lrtest(pceggmod3,pceggmod1)
lrtest(pceggmod3b,pceggmod3)
lrtest(pceggmod2,pceggmod1)
#random effect model
FFdataPC$idnum <- as.factor(FFdataPC$idnum)
pcnona<-which(FFdataPC$egg_total==0)
FFnonaPC<-FFdataPC[-pcnona,]
#Null model with no predictors
pchatchmodnull<-glm.nb(hatch_total~offset(log(egg_total)), data=FFnonaPC)
#Null Model without principal compoenents but with infection and lifespan
pchatchmod0<-glm.nb(hatch_total~infected+lifespan+offset(log(egg_total)),
data=FFnonaPC)
#AIC=1140
#Null Model without lifespan
pchatchmod0a<-glm.nb(hatch_total~infected+offset(log(egg_total)), data=FFnonaPC)
#1138.4 (lifespan can be removed.)
#No components, trial added.
pchatchmod0b<-glm.nb(hatch_total~infected+trial+offset(log(egg_total)),
data=FFnonaPC)
#Model with 1 PC
pchatchmod1<-glm.nb(hatch_total~infected+HComp.1+offset(log(egg_total)),
data=FFnonaPC)
pchatchmod1b<-glm.nb(hatch_total~infected+factor(trial)+HComp.1+
offset(log(egg_total)), data=FFnonaPC)
pchatchmod1c<-glm.nb(hatch_total~infected+factor(trial)*HComp.1+
offset(log(egg_total)), data=FFnonaPC)
pchatchmod1d<-glm.nb(hatch_total~infected+lifespan+HComp.1+
offset(log(egg_total)), data=FFnonaPC)
pchatchmod1e<-glm.nb(hatch_total~infected+lifespan+factor(trial)*
HComp.1+offset(log(egg_total)), data=FFnonaPC)
#Model with 2 PC
pchatchmod2<-glm.nb(hatch_total~infected+HComp.1+HComp.2+offset(log(egg_total)
), data=FFnonaPC)
pchatchmod2b<-glm.nb(hatch_total~infected+factor(trial)+HComp.1+HComp.2+
offset(log(egg_total)), data=FFnonaPC)
pchatchmod2c<-glm.nb(hatch_total~infected+HComp.1+HComp.2*factor(trial)+
offset(log(egg_total)), data=FFnonaPC)
pchatchmod2d<-glm.nb(hatch_total~infected+lifespan+HComp.1+HComp.2+factor(trial)+
offset(log(egg_total)), data=FFnonaPC)
pchatchmod2e<-glm.nb(hatch_total~infected+HComp.2+HComp.1*factor(trial)+
lifespan+offset(log(egg_total)), data=FFnonaPC)
#Model with 3 PC
pchatchmod3<-glm.nb(hatch_total~infected+HComp.1+HComp.2+HComp.3+
offset(log(egg_total)), data=FFnonaPC)
#Model with 3 PC
pchatchmod3a<-glm.nb(hatch_total~infected+HComp.1+HComp.2+HComp.3+factor(trial)
+offset(log(egg_total)), data=FFnonaPC)
pchatchmod3b<-glm.nb(hatch_total~infected+HComp.1+HComp.2+HComp.3+factor(trial)
+offset(log(egg_total)), data=FFnonaPC)
pchatchmod3c<-glm.nb(hatch_total~infected+HComp.1+HComp.2+HComp.3+lifespan+
offset(log(egg_total)), data=FFnonaPC)
#Model with 4 PC  #using 4 PC overfits PC
pchatchmod4<-glm.nb(hatch_total~infected+HComp.1+HComp.2+HComp.3+HComp.4+
offset(log(egg_total)), data=FFnonaPC)
pchatchmod0#1140 SE inf=0.05
pchatchmod0a#1140
pchatchmod0b#1140 SE 0.49
pchatchmod1#1140
pchatchmod1b#1144
pchatchmod1c#1144
pchatchmod1d#1142
pchatchmod1e#1144
pchatchmod2#1141.9
pchatchmod2b#1141.5
pchatchmod2c#1144
pchatchmod2d#1141
pchatchmod2e#1143
pchatchmod3#1143
pchatchmod3a#1142
pchatchmod3b#1142
pchatchmod3c#1145
pchatchmod4
#perform likelihood ratio test
lrtest(pchatchmod1,pchatchmod0)
#lrtest(pchatchmod4,pchatchmod2)#
#lrtest(pchatchmod4,pchatchmod1)
#lrtest(pchatchmod4,pchatchmod0)
#lrtest(pchatchmod2,pchatchmod1)
#adding random effects
#look at realtion between HComp 1 and HComp=2
HCp<-ggplot(data=FFnonaPC, aes( y= HComp.2, x= HComp.1))+
geom_point(aes(shape=factor(infected), color=factor(trial)))
HCp
